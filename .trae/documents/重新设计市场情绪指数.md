# 重新设计市场情绪指数

## 1. 现状分析
当前市场情绪指数基于四个指标：
- 涨停股票数量（30%）
- 连板高度（25%）
- 封板成功率（25%）
- 换手率活跃度（20%）

## 2. 改进方案
重新设计的市场情绪指数将整合更多超短交易关键指标，包括：

### 2.1 核心指标体系

| 指标类别 | 具体指标 | 权重 | 计算方式 |
|---------|---------|------|----------|
| 涨停强度 | 涨停股票数量 | 15% | 归一化到0-100 |
| 连板梯队 | 最高连板高度 | 15% | 归一化到0-100 |
|  | 连板股票数量 | 10% | 归一化到0-100 |
| 晋级效应 | 整体晋级率 | 15% | 基于各梯队晋级率计算 |
|  | 首板晋级二板率 | 10% | 直接使用晋级率数据 |
| 封板质量 | 封板成功率 | 10% | 无炸板涨停数/总涨停数 |
|  | 炸板率 | 10% | 炸板数/触及涨停数 |
| 赚钱效应 | 昨日涨停开盘溢价率 | 10% | 基于溢价率统计 |
|  | 昨日涨停收盘溢价率 | 5% | 基于溢价率统计 |

### 2.2 实现步骤

1. **修改 `calculate_sentiment_value` 函数**：
   - 整合晋级率数据（从 `create_advancement_rate_chart` 函数获取逻辑）
   - 添加炸板率计算
   - 整合昨日涨停溢价率数据
   - 调整权重分配

2. **优化数据处理**：
   - 确保各指标数据的准确性和完整性
   - 添加数据平滑处理（如移动平均线）
   - 优化归一化方法

3. **增强可视化效果**：
   - 在情绪指数图表中添加更多参考线
   - 显示各子指标对情绪指数的贡献
   - 添加情绪状态标签（如"极度乐观"、"谨慎乐观"、"中性"、"谨慎悲观"、"极度悲观"）

### 2.3 预期效果

- 更全面反映超短市场情绪变化
- 更准确捕捉市场转折点
- 提供更详细的情绪分解信息
- 增强对超短交易决策的参考价值

## 3. 代码修改计划

1. **更新 `calculate_sentiment_value` 函数**（138-184行）：
   - 重构指标计算逻辑
   - 添加新指标
   - 调整权重

2. **优化 `create_sentiment_chart` 函数**（850-888行）：
   - 增强图表可视化效果
   - 添加情绪状态标签
   - 显示指标贡献分解

3. **添加辅助函数**：
   - 计算晋级率数据
   - 计算炸板率
   - 整合溢价率数据

通过以上改进，新的市场情绪指数将更全面、更准确地反映A股超短市场的真实情绪，为超短交易者提供更有价值的决策参考。